{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the TaskZen application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The display name of the user."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "fcmTokens": {
          "type": "array",
          "description": "An array of Firebase Cloud Messaging (FCM) tokens for sending push notifications.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a project containing tasks.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the project entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Project)"
        },
        "name": {
          "type": "string",
          "description": "Name of the project."
        },
        "description": {
          "type": "string",
          "description": "Description of the project."
        },
        "color": {
          "type": "string",
          "description": "Color associated with the project for UI representation."
        },
        "icon": {
          "type": "string",
          "description": "Icon associated with the project for UI representation."
        }
      },
      "required": [
        "id",
        "userId",
        "name"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task within a project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Task)"
        },
        "name": {
          "type": "string",
          "description": "Name of the task."
        },
        "description": {
          "type": "string",
          "description": "Description of the task."
        },
        "deadline": {
          "type": "string",
          "description": "Deadline for the task.",
          "format": "date-time"
        },
        "priority": {
          "type": "string",
          "description": "Priority of the task (e.g., low, medium, high)."
        },
        "status": {
          "type": "string",
          "description": "Status of the task (e.g., incomplete, in progress, complete, overdue)."
        }
      },
      "required": [
        "id",
        "projectId",
        "name"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores projects created by a specific user. Enforces path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores tasks within a specific project. Enforces path-based ownership. Given the user's ability to create tasks, the task data is immutable after creation, simplifying security rules.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to be secure, scalable, and easy to debug, following the principles of Authorization Independence, Clarity of Intent, and DBAC. It uses denormalization to avoid hierarchical authorization dependencies.  The structure is segregated by putting different access entities into different collections. Access is modeled with Path-Based ownership. Given the user's ability to create projects and tasks, the proposed structure focuses on organizing the data in a way that reflects the user's ownership and the relationships between users, projects, and tasks.\n\n*   `/users/{userId}`: Stores user profiles.  Access is restricted to the user themselves. Includes standard profile information.\n*   `/users/{userId}/projects/{projectId}`: Stores projects created by a specific user. Enforces path-based ownership.\n*   `/users/{userId}/projects/{projectId}/tasks/{taskId}`: Stores tasks within a specific project.  Enforces path-based ownership. Since users cannot edit existing tasks, the task data is immutable after creation, simplifying security rules.\n\nThis design ensures authorization independence because access to projects and tasks is determined by the user ID in the path, avoiding `get()` calls to parent documents. It supports the QAPs (Rules are not Filters) principle because listing projects and tasks is naturally scoped to a specific user, preventing the need for filtering on the client side.  It also supports the creation of collaborative features in the future by adding a membership map into project or task documents and adjusting security rules appropriately. Given the requirement to get reminders, a cloud function should be created to monitor for new task documents and send notifications to the user based on the provided deadline."
  }
}